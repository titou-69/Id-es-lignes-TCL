<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>R√©seau de bus</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw/dist/leaflet.draw.css" />

  <style>
    body { margin: 0; font-family: sans-serif; }
    #map { height: 100vh; }

    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      width: 300px;
      border-radius: 6px;
    }

    label { display: block; margin-top: 10px; }
    button { margin-top: 15px; }
  </style>
</head>
<body>

<div id="map"></div>

<!-- MODALE -->
<div id="modal" class="modal">
  <div class="modal-content" id="modal-content"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
<script src="app.js"></script>

</body>
</html>

// app.js

const map = L.map('map').setView([45.75, 4.85], 13);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

// Groupes de calques
const lignesBus = {};
const arrets = new L.FeatureGroup().addTo(map);

map.addControl(new L.Control.Draw({
  edit: { featureGroup: arrets },
  draw: {
    polygon: false,
    rectangle: false,
    circle: false,
    circlemarker: false
  }
}));

// Modale utilitaire
function openModal(html, onSubmit) {
  const modal = document.getElementById("modal");
  const content = document.getElementById("modal-content");

  content.innerHTML = html;
  modal.style.display = "flex";

  content.querySelector("form").onsubmit = (e) => {
    e.preventDefault();
    modal.style.display = "none";
    onSubmit(new FormData(e.target));
  };
}

// Gestion du dessin
map.on(L.Draw.Event.CREATED, function (e) {
  const layer = e.layer;

  // üü¢ CAS 1 : ARR√äT DE BUS
  if (e.layerType === 'marker') {
    openModal(`
      <h3>Nouvel arr√™t</h3>
      <form>
        <label>Nom de l'arr√™t</label>
        <input name="nom" required>

        <label>Ligne</label>
        <input name="ligne" required>

        <button>Valider</button>
      </form>
    `, data => {
      layer.bindPopup(
        `<b>${data.get("nom")}</b><br>Ligne ${data.get("ligne")}`
      );
      arrets.addLayer(layer);
    });
  }

  // üü° CAS 2 : LIGNE DE BUS
  if (e.layerType === 'polyline') {
    openModal(`
      <h3>Nouvelle ligne</h3>
      <form>
        <label>Num√©ro de ligne</label>
        <input name="ligne" required>

        <label>D√©part</label>
        <input name="depart">

        <label>Arriv√©e</label>
        <input name="arrivee">

        <button>Valider</button>
      </form>
    `, data => {
      const nomLigne = data.get("ligne");

      if (!lignesBus[nomLigne]) {
        lignesBus[nomLigne] = new L.FeatureGroup().addTo(map);
      }

      layer.bindPopup(
        `<b>Ligne ${nomLigne}</b><br>${data.get("depart")} ‚Üí ${data.get("arrivee")}`
      );

      lignesBus[nomLigne].addLayer(layer);
    });
  }
});

function creerDepot() {
  openModal(`
    <h3>Nouveau d√©p√¥t</h3>
    <form>
      <label>Nom du d√©p√¥t</label>
      <input name="depot" required>
      <button>Cr√©er</button>
    </form>
  `, data => {
    alert("D√©p√¥t cr√©√© : " + data.get("depot"));
  });
}
